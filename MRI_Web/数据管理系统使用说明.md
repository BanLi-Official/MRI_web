# 数据管理系统使用说明

## 系统概述

本系统为智能博客项目新增的数据管理功能，支持多层数据组织结构，专门用于管理医学影像数据（MRI、PET、CT等）。

## 系统架构

### 三层数据结构

1. **第一层：数据类型（DataType）**
   - MRI（磁共振成像）
   - PET（正电子发射断层扫描）
   - CT（计算机断层扫描）
   - 超声（Ultrasound）
   - X光（X-ray）
   - 其他（Other）

2. **第二层：数据源（DataSource）**
   - 按数据来源分组（如：医院A、研究机构B等）
   - 包含数据源详细信息、联系信息、数据质量等

3. **第三层：数据文件（DataFile）**
   - 实际的数据文件存储
   - 支持DICOM、NIfTI、MATLAB等多种格式

## 功能特性

### 管理员功能
- ✅ 创建和管理数据类型
- ✅ 查看所有数据源和文件
- ✅ 编辑任何数据源信息
- ✅ 删除任何文件
- ✅ 系统配置管理

### 用户功能
- ✅ 浏览数据类型和数据源
- ✅ 创建数据源（需登录）
- ✅ 上传数据文件
- ✅ 下载数据文件
- ✅ 搜索和过滤数据
- ✅ 编辑自己创建的数据源
- ✅ 删除自己上传的文件

### 数据安全
- ✅ 权限控制：私有/公开数据源
- ✅ 用户认证：登录用户才能上传
- ✅ 软删除：文件删除后仍可恢复
- ✅ 下载计数：统计文件使用情况

## 使用流程

### 1. 管理员初始化

```bash
# 启动服务器
python manage.py runserver 0.0.0.0:8000

# 访问管理后台
http://localhost:8000/admin/

# 创建管理员账号（如果还没有）
python manage.py createsuperuser
```

### 2. 数据类型管理

管理员可以：
1. 访问 `/data-types/` 查看所有数据类型
2. 点击"创建数据类型"添加新的数据类型
3. 设置图标、颜色、描述等信息

### 3. 数据源管理

用户可以：
1. 访问 `/data-sources/` 查看所有公开数据源
2. 点击"创建数据源"添加新的数据源
3. 填写数据源信息：
   - 数据源名称
   - 机构信息
   - 联系人信息
   - 数据质量等级
   - 访问权限设置

### 4. 文件上传

用户可以：
1. 访问 `/data-files/upload/` 上传文件
2. 选择数据源
3. 填写文件信息：
   - 文件名和描述
   - 患者ID（匿名化）
   - 扫描参数
   - 标签分类

### 5. 文件下载

用户可以：
1. 浏览数据源详情页面
2. 查看文件列表
3. 点击下载按钮获取文件
4. 系统自动记录下载次数

## 支持的文件格式

- **DICOM** (.dcm) - 医学影像标准格式
- **NIfTI** (.nii) - 神经影像学数据格式
- **MATLAB** (.mat) - MATLAB数据文件
- **原始数据** (.raw) - 原始二进制数据
- **图像文件** (.jpg, .jpeg, .png, .tiff) - 标准图像格式

## 数据组织结构示例

```
数据类型: MRI
├── 数据源: 北京医院MRI数据
│   ├── 文件1: brain_mri_001.dcm
│   ├── 文件2: spine_mri_002.dcm
│   └── 文件3: knee_mri_003.dcm
├── 数据源: 上海研究所脑部数据
│   ├── 文件1: brain_study_001.nii
│   └── 文件2: brain_study_002.nii
└── 数据源: 深圳医院关节数据
    └── 文件1: joint_mri_001.mat

数据类型: CT
├── 数据源: 广州医院CT数据
│   ├── 文件1: chest_ct_001.dcm
│   └── 文件2: abdomen_ct_002.dcm
└── 数据源: 成都医院骨骼数据
    └── 文件1: bone_ct_001.dcm
```

## 搜索和过滤

系统提供多种搜索和过滤功能：

1. **按数据类型过滤**：选择特定的数据类型
2. **关键词搜索**：搜索数据源名称、描述、机构
3. **数据质量过滤**：按质量等级筛选
4. **分页浏览**：支持大量数据的分页显示

## 统计信息

系统自动统计：
- 每个数据类型的文件数量
- 每个数据源的文件数量和总大小
- 文件的下载次数
- 数据源创建时间

## 技术特性

- **响应式设计**：支持桌面和移动设备
- **Bootstrap UI**：现代化的用户界面
- **FontAwesome图标**：丰富的图标支持
- **Ajax交互**：流畅的用户体验
- **文件大小格式化**：自动显示合适的单位（B/KB/MB/GB/TB）

## 安全考虑

1. **权限控制**：
   - 管理员可以访问所有数据
   - 普通用户只能访问公开数据源
   - 用户可以管理自己创建的内容

2. **数据保护**：
   - 患者ID匿名化
   - 文件软删除机制
   - 访问日志记录

3. **文件安全**：
   - 支持多种医学影像格式
   - 文件大小限制
   - 病毒扫描建议

## 扩展功能

系统设计支持未来扩展：
- 数据版本控制
- 批量文件操作
- 数据质量评估
- 数据共享协议
- API接口支持
- 数据备份和恢复

## 故障排除

### 常见问题

1. **文件上传失败**
   - 检查文件格式是否支持
   - 确认文件大小未超过限制
   - 验证用户登录状态

2. **权限错误**
   - 确认用户有相应权限
   - 检查数据源是否公开
   - 验证用户身份

3. **页面显示异常**
   - 检查网络连接
   - 清除浏览器缓存
   - 确认JavaScript已启用

### 联系支持

如遇到问题，请联系系统管理员或查看Django管理后台的日志信息。

---

**版本**: 1.0  
**更新时间**: 2024年  
**维护者**: 系统管理员

